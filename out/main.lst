C51 COMPILER V9.55   MAIN                                                                  07/22/2020 09:38:55 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\out\main.obj
COMPILER INVOKED BY: c:\Keil_v5\C51\BIN\C51.exe c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\src\main.c SMALL O
                    -MF2 ROM(SMALL) OPTIMIZE(8,SPEED) REGFILE(c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\out\main.ORC) INCDIR(d:\S
                    -DK\msc51;c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\dependence;c:\Keil_v5\C51\INC) PRINT(c:\Users\Administrat
                    -or\Documents\Source\MCU\Sdcc-51\.\out\main.lst) TABS(2) OBJECT(c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\out
                    -\main.obj)

line level    source

   1          #include "C:\\Users\\Administrator\\Documents\\Source\\MCU\\Sdcc-51\\src\\STC15Fxxxx.H"
   2          #include <intrins.h>
   3          #include "C:\\Users\\Administrator\\Documents\\Source\\MCU\\Sdcc-51\\src\\EEPROM.h"
   4          #include "C:\\Users\\Administrator\\Documents\\Source\\MCU\\Sdcc-51\\src\\adc.h"
   5          
   6          sbit X0 = P1^2;
   7          sbit X1 = P1^3;
   8          sbit X2 = P1^4;
   9          sbit X3 = P1^5;
  10          
  11          sbit Y0 = P3^3;
  12          sbit Y1 = P3^2;
  13          
  14          static int Maxact=3;
  15          static char Makeup1,Makeup2;
  16          
  17          int Act1(); //大先小后
  18          int Act2(); //仅大
  19          int Act3(); //小大小大
  20          int Act4(); //小大大小
  21          
  22          void AdcInit();
  23          int AdcExcute();
  24          int EEPROMend();
  25          
  26          
  27          
  28          void  delay_ms(unsigned int ms)
  29          {
  30   1          unsigned int i;
  31   1        do{
  32   2            i = 12000000L / 13000;
  33   2          while(--i)  ;   //14T per loop
  34   2          }while(--ms);
  35   1      }
  36          
  37          u16 result1=0;
  38          u16 result2=0;
  39          u8 act;
  40          u8 n=0;
  41          int i=0;
  42          u8 X3X=1;
  43          u8 X0X=1;
  44          u16 addr;
  45            
  46              
  47              
  48          int Act1()
  49          {
  50   1        Y0=0;
  51   1        while(1)
C51 COMPILER V9.55   MAIN                                                                  07/22/2020 09:38:55 PAGE 2   

  52   1        {
  53   2          if(X1==0)
  54   2          {
  55   3            delay_ms(result1);
  56   3            Y1=0;
  57   3            while(1)
  58   3            {
  59   4              if(X2==0)
  60   4              {
  61   5                delay_ms(result2);
  62   5                Y1=1;
  63   5                delay_ms(50);
  64   5                Y0=1;
  65   5                return 0;
  66   5              }
  67   4            }
  68   3            return 0;
  69   3          }
  70   2        }
  71   1        return 0;
  72   1      }
  73          
  74          int Act2()
  75          {
  76   1        Y0=0;
  77   1        while(1)
  78   1        {
  79   2          if(X1==0)
  80   2          {
  81   3            delay_ms(result1);
  82   3            Y0=1;
  83   3            while(1)
  84   3            {
  85   4              if(X1==1)
  86   4              {
  87   5                return 0;
  88   5              }
  89   4            }
  90   3            return 0;
  91   3          }
  92   2        }
  93   1        return 0;
  94   1      }
  95          
  96          int Act3()
  97          {
  98   1        Y1=0;
  99   1        while(1)
 100   1        {
 101   2          if(X2==0)
 102   2          {
 103   3            delay_ms(result2);
 104   3            Y0=0;
 105   3            while(1)
 106   3            {
 107   4              if(X1==0)
 108   4              {
 109   5                delay_ms(result1);
 110   5                Y1=1;
 111   5                delay_ms(30);
 112   5                Y0=1;
 113   5                while (1)
C51 COMPILER V9.55   MAIN                                                                  07/22/2020 09:38:55 PAGE 3   

 114   5                {
 115   6                  if(X1==1&&X2==1)
 116   6                  {
 117   7                    return;
 118   7                  }
 119   6                }
 120   5                return 0;
 121   5              }
 122   4            }
 123   3          }
 124   2        }
 125   1      }
 126          
 127          int Act4()
 128          {
 129   1        Y1=0;
 130   1        while(1)
 131   1        {
 132   2          if(X2==0)
 133   2          {
 134   3            delay_ms(result2);
 135   3            Y0=0;
 136   3            while(1)
 137   3            {
 138   4              if(X1==0)
 139   4              {
 140   5                delay_ms(result1);
 141   5                Y0=1;
 142   5                delay_ms(30);
 143   5                Y1=1;
 144   5                while (1)
 145   5                {
 146   6                  if(X1==1&&X2==1)
 147   6                  {
 148   7                    return;
 149   7                  }
 150   6                }
 151   5                
 152   5              }
 153   4            }
 154   3          }
 155   2        }
 156   1      }
 157          
 158          
 159          void AdcInit()
 160          {
 161   1        P1ASF = ADC_P11 | ADC_P10;
 162   1        ADC_CONTR = (ADC_CONTR & ~ADC_90T) | ADC_360T;
 163   1        ADC_CONTR |= 0x80;
 164   1        CLK_DIV |=  (1<<5); //10位AD结果的高2位放ADC_RES的低2位，低8位在ADC_RESL。
 165   1        EADC = 1;     //中断允许    ENABLE,DISABLE
 166   1        PADC = 1;   //优先级设置 PolityHigh,PolityLow
 167   1        ADC_CONTR |=0x80;
 168   1        delay_ms(200);
 169   1      }
 170          
 171          int AdcExcute()
 172          {
 173   1        Get_ADC10bitResult(0);
 174   1        delay_ms(50);
 175   1        result1=Get_ADC10bitResult(0);
C51 COMPILER V9.55   MAIN                                                                  07/22/2020 09:38:55 PAGE 4   

 176   1        delay_ms(50);
 177   1        Get_ADC10bitResult(1);
 178   1        delay_ms(50);
 179   1        result2=Get_ADC10bitResult(1);
 180   1        //result1=result1-Makeup1;
 181   1        //result2=result2-Makeup2;
 182   1      }
 183          
 184          
 185          int EEPROMend()
 186          {
 187   1        EEPROM_SectorErase(0x00);
 188   1        delay_ms(5);
 189   1        EEPROM_write_n(0x00,&act,1);
 190   1      }
 191          
 192          
 193          int main()
 194          {
 195   1        P1M1=0x03;
 196   1        P1M0=0x00;
 197   1        P3M0=0x00;
 198   1        P3M1=0x00;
 199   1      
 200   1        AdcInit();
 201   1        delay_ms(300);
 202   1        AdcExcute();
 203   1        while(result1==1024)
 204   1        {
 205   2          delay_ms(500);
 206   2          AdcExcute();
 207   2        }
 208   1        while(result2==1024)
 209   1        {
 210   2          delay_ms(500);
 211   2          AdcExcute();
 212   2        }
 213   1        if(result1<600)result1=650;
 214   1        if(result2<600)result2=650;
 215   1        result1=result1-600;
 216   1        result2=result2-600;
 217   1        EEPROM_read_n(0x0000,&act,1);
 218   1        if(act>Maxact)act=0;
 219   1        if(act<0)act=0;
 220   1        P1=0XFF;
 221   1        while(1)
 222   1        {
 223   2          if((X1!=0)&&(X2!=0))
 224   2          {
 225   3            delay_ms(5);
 226   3            if(X0==0)
 227   3            {
 228   4              switch (act)
 229   4              {
 230   5              case 0:
 231   5                Act1();
 232   5                break;
 233   5              case 1:
 234   5                Act2();
 235   5                break;
 236   5              case 2:
 237   5                Act3();
C51 COMPILER V9.55   MAIN                                                                  07/22/2020 09:38:55 PAGE 5   

 238   5                break;
 239   5              case 3:
 240   5                Act4();
 241   5                break;
 242   5              default:
 243   5                break;
 244   5              }
 245   4              if(X0==0)
 246   4              {
 247   5                while(1)
 248   5                {
 249   6                  if(X0!=0)break;
 250   6                }
 251   5              }
 252   4            }
 253   3          }
 254   2          if(X3==0)
 255   2          {
 256   3            delay_ms(10);
 257   3            if(X3==0)
 258   3            {
 259   4              act++;
 260   4              if(act>Maxact)act=0;
 261   4              EEPROM_SectorErase(0x0000);
 262   4              delay_ms(100);
 263   4              EEPROM_write_n(0x0000,&act,1);
 264   4              delay_ms(100);
 265   4              IAP_CONTR=0x60;
 266   4            }
 267   3          }
 268   2        }
 269   1      }
*** WARNING C294 IN LINE 68 OF c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\src\main.c: unreachable code
*** WARNING C294 IN LINE 71 OF c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\src\main.c: unreachable code
*** WARNING C294 IN LINE 90 OF c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\src\main.c: unreachable code
*** WARNING C294 IN LINE 93 OF c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\src\main.c: unreachable code
*** WARNING C294 IN LINE 120 OF c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\src\main.c: unreachable code
*** WARNING C290 IN LINE 125 OF c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\src\main.c: missing return value
*** WARNING C290 IN LINE 156 OF c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\src\main.c: missing return value
*** WARNING C290 IN LINE 182 OF c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\src\main.c: missing return value
*** WARNING C290 IN LINE 190 OF c:\Users\Administrator\Documents\Source\MCU\Sdcc-51\.\src\main.c: missing return value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    523    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  9 WARNING(S),  0 ERROR(S)
